@model ChatViewModel

<div id="chat-container">
    <div id="chat-messages">
        @if (Model.Messages != null && Model.Messages.Count > 2)
        {
            var messagesToDisplay = Model.Messages.Skip(2);//это костыль чтобы не дублировались старые сообщение(приветствие и выберете раздел)
            foreach (var message in messagesToDisplay)
            {
                <div class="chat-message">
                    <strong>@message.UserName:</strong> @message.Message <br />
                    <small>@message.Data.ToString("g")</small>
                </div>
            }
        }
        else
        {
            <p>Нет сообщений.</p>
        }
    </div>

    <div id="question-buttons">
        @if (Model.MainQuestions != null && Model.MainQuestions.Any())
        {
            foreach (var question in Model.MainQuestions)
            {
                <button class="question-button" data-id="@question.Id" data-tree="@question.Tree" data-name="@question.Name">
                    @question.Name
                </button>
            }
        }
        else
        {
            <p>Нет доступных под-вопросов.</p>
        }
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).on("click", ".question-button", function () {
        var questionId = $(this).data("id");
        var tree = $(this).data("tree");
        var uid = "@Model.Uid";
        var questionName = $(this).data("name"); // Получаем имя вопроса

        // Вызываем метод выбора вопроса
        $.post('/Chat/SelectQuestion', { questionId: questionId, tree: tree, uid: uid, questionName: questionName })
            .done(function (data) {
                // Обновляем только под-вопросы
                $("#question-buttons").html(data);

                // Теперь обновляем сообщения
                $.post('/Chat/UpdateMessages', { uid: uid })
                    .done(function (messageData) {
                        // Обновляем сообщения
                        $("#chat-messages").html(messageData);
                        // Прокручиваем вниз после добавления новых сообщений
                        scrollToBottom();
                    })
                    .fail(function () {
                        console.error("Ошибка при получении сообщений.");
                    });
            })
            .fail(function () {
                console.error("Ошибка при получении под-вопросов.");
            });
    });
</script>